---

- name: TripleO inventory creation
  hosts: localhost
  gather_facts: no
  tasks:
    - name: TripleO Clouds Inventory
      ansible.builtin.import_role:
        name: tripleo_clouds_inventory

    - name: Update Infrared Workspace Inventory
      ansible.builtin.copy:
        src: "{{ environment_dir }}/inventory_{{ host }}"
        dest: "{{ inventory_dir }}/tripleo-inventory-hosts"

    # Workaround  for infrared requirement of [overcloud_nodes] group
    # that is not generated by infrared inventory template
    - name: Create empty overcloud_nodes Group If Not Present
      add_host:
        name: "\n"
        groups: "overcloud_nodes"
        ansible_host: ""
        ansible_user: ""
        ansible_ssh_private_key_file: ""
        ansible_ssh_pass: ""
      when: "'overcloud_nodes' not in groups"

    - name: Generate Infrared Inventory
      vars:
        inventory_file_name: 'tripleo-inventory'
      ansible.builtin.import_role:
        name: inventory-update
